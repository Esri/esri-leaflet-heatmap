{"version":3,"file":"esri-leaflet-heatmap.js","sources":["../src/HeatmapFeatureLayer.js"],"sourcesContent":["import L from 'leaflet';\r\nimport { FeatureManager } from 'esri-leaflet';\r\nimport packageInfo from '../package.json';\r\nvar version = packageInfo.version;\r\nexport { version as VERSION };\r\n\r\nexport var FeatureLayer = FeatureManager.extend({\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureManager.prototype.initialize.call(this, options);\r\n\r\n    options = L.setOptions(this, options);\r\n\r\n    this._cache = {};\r\n    this._active = {};\r\n\r\n    this.heat = window.L.heatLayer([], options);\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    FeatureManager.prototype.onAdd.call(this, map);\r\n    this._map.addLayer(this.heat);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    FeatureManager.prototype.onRemove.call(this, map);\r\n    this._map.removeLayer(this.heat);\r\n  },\r\n\r\n  /**\r\n   * Feature Managment Methods\r\n   */\r\n\r\n  createLayers: function (features) {\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var geojson = features[i];\r\n      var id = geojson.id;\r\n      var latlng = new L.LatLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]);\r\n      this._cache[id] = latlng;\r\n\r\n      // add the layer if it is within the time bounds or our layer is not time enabled\r\n      if (!this._active[id] && (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)))) {\r\n        this._active[id] = latlng;\r\n        this.heat._latlngs.push(latlng);\r\n      }\r\n    }\r\n\r\n    this.heat.redraw();\r\n  },\r\n\r\n  addLayers: function (ids) {\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      if (!this._active[id]) {\r\n        var latlng = this._cache[id];\r\n        this.heat._latlngs.push(latlng);\r\n        this._active[id] = latlng;\r\n      }\r\n    }\r\n    this.heat.redraw();\r\n  },\r\n\r\n  removeLayers: function (ids, permanent) {\r\n    var newLatLngs = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      if (this._active[id]) {\r\n        delete this._active[id];\r\n      }\r\n      if (this._cache[id] && permanent) {\r\n        delete this._cache[id];\r\n      }\r\n    }\r\n\r\n    for (var latlng in this._active) {\r\n      newLatLngs.push(this._active[latlng]);\r\n    }\r\n\r\n    this.heat.setLatLngs(newLatLngs);\r\n  },\r\n\r\n  setOptions: function (options) {\r\n    this.heat.setOptions(options);\r\n  },\r\n\r\n  redraw: function () {\r\n    this.heat.redraw();\r\n  }\r\n\r\n});\r\n\r\nexport function featureLayer (options) {\r\n  return new FeatureLayer(options);\r\n}\r\n\r\nexport default featureLayer;\r\n"],"names":["version","FeatureLayer","FeatureManager","extend","initialize","options","prototype","call","this","L","setOptions","_cache","_active","heat","window","heatLayer","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","i","length","geojson","id","latlng","LatLng","geometry","coordinates","timeField","_featureWithinTimeRange","_latlngs","push","redraw","addLayers","ids","removeLayers","permanent","newLatLngs","setLatLngs","featureLayer"],"mappings":";;;+bAGIA,UAGOC,EAAeC,EAAcA,eAACC,OAAO,CAK9CC,WAAY,SAAUC,GACpBH,EAAcA,eAACI,UAAUF,WAAWG,KAAKC,KAAMH,GAE/CA,EAAUI,EAAAA,QAAEC,WAAWF,KAAMH,GAE7BG,KAAKG,OAAS,GACdH,KAAKI,QAAU,GAEfJ,KAAKK,KAAOC,OAAOL,EAAEM,UAAU,GAAIV,IAOrCW,MAAO,SAAUC,GACff,EAAcA,eAACI,UAAUU,MAAMT,KAAKC,KAAMS,GAC1CT,KAAKU,KAAKC,SAASX,KAAKK,OAG1BO,SAAU,SAAUH,GAClBf,EAAcA,eAACI,UAAUc,SAASb,KAAKC,KAAMS,GAC7CT,KAAKU,KAAKG,YAAYb,KAAKK,OAO7BS,aAAc,SAAUC,GACtB,IAAK,IAAIC,EAAID,EAASE,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC7C,IAAIE,EAAUH,EAASC,GACnBG,EAAKD,EAAQC,GACbC,EAAS,IAAInB,EAAAA,QAAEoB,OAAOH,EAAQI,SAASC,YAAY,GAAIL,EAAQI,SAASC,YAAY,IACxFvB,KAAKG,OAAOgB,GAAMC,GAGbpB,KAAKI,QAAQe,MAASnB,KAAKH,QAAQ2B,WAAcxB,KAAKH,QAAQ2B,WAAaxB,KAAKyB,wBAAwBP,MAC3GlB,KAAKI,QAAQe,GAAMC,EACnBpB,KAAKK,KAAKqB,SAASC,KAAKP,IAI5BpB,KAAKK,KAAKuB,UAGZC,UAAW,SAAUC,GACnB,IAAK,IAAId,EAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,IAAIG,EAAKW,EAAId,GACb,IAAKhB,KAAKI,QAAQe,GAAK,CACrB,IAAIC,EAASpB,KAAKG,OAAOgB,GACzBnB,KAAKK,KAAKqB,SAASC,KAAKP,GACxBpB,KAAKI,QAAQe,GAAMC,GAGvBpB,KAAKK,KAAKuB,UAGZG,aAAc,SAAUD,EAAKE,GAE3B,IADA,IAAIC,EAAa,GACRjB,EAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,IAAIG,EAAKW,EAAId,GACThB,KAAKI,QAAQe,WACRnB,KAAKI,QAAQe,GAElBnB,KAAKG,OAAOgB,IAAOa,UACdhC,KAAKG,OAAOgB,GAIvB,IAAK,IAAIC,KAAUpB,KAAKI,QACtB6B,EAAWN,KAAK3B,KAAKI,QAAQgB,IAG/BpB,KAAKK,KAAK6B,WAAWD,IAGvB/B,WAAY,SAAUL,GACpBG,KAAKK,KAAKH,WAAWL,IAGvB+B,OAAQ,WACN5B,KAAKK,KAAKuB,YAKP,SAASO,EAActC,GAC5B,OAAO,IAAIJ,EAAaI"}